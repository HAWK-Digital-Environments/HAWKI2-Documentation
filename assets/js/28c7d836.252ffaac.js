"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[788],{6629:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>l,frontMatter:()=>o,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"HAWKI/Architecture/Encryption","title":"Encryption","description":"Introduction","source":"@site/docs/HAWKI/3-Architecture/4-Encryption.md","sourceDirName":"HAWKI/3-Architecture","slug":"/HAWKI/Architecture/Encryption","permalink":"/HAWKI2-Documentation/HAWKI/Architecture/Encryption","draft":false,"unlisted":false,"editUrl":"https://github.com/hawk/your-project/edit/main/docs/HAWKI/3-Architecture/4-Encryption.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"HAWKI_Sidebar","previous":{"title":"Models Views Controllers","permalink":"/HAWKI2-Documentation/HAWKI/Architecture/MVC"},"next":{"title":"Model Connection","permalink":"/HAWKI2-Documentation/HAWKI/Architecture/Model Connection"}}');var r=s(4848),t=s(8453);const o={sidebar_position:4},c=void 0,a={},h=[{value:"Introduction",id:"introduction",level:2},{value:"Registration",id:"registration",level:2},{value:"Message Encryption",id:"message-encryption",level:2},{value:"AI Conversation Messages (AiConvMsg)",id:"ai-conversation-messages-aiconvmsg",level:3},{value:"Room Messages",id:"room-messages",level:3},{value:"Key Exchange",id:"key-exchange",level:2},{value:"Private Data Encryption",id:"private-data-encryption",level:2}];function d(e){const n={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)(n.p,{children:"Encryption can be one of the more complicated parts of HAWKI2.\nBasically, most of the encryption in HAWKI is done on the client side. This ensures that a minimum of data leaves the browser unencrypted. In addition to the SSL encryption after deployment, this also guarantees the integrity of the data all over the platform."}),"\n",(0,r.jsx)(n.p,{children:'To review the encryption process, we start with the registration process and the creation of the required keys during the process when the user first enters the platform. As mentioned in the introduction, HAWKI\'s main authentication mechanism relies on external authentication services (LDAP, Shibboleth, OpenID). Although this facilitates the integration of HAWKI into an organisation\'s infrastructure, such as universities and companies, it also makes it more difficult to monitor changes in user information. In this respect, HAWKI\'s encryption is based on a unique passkey that gives each user a unique signature to encrypt and store their private data. We have adapted two terms in the frontend for users to make them easier to understand. The "passkey" described here has been renamed for the user to "Datakey" and the "backup code" described here is called "Wiederherstellungscode" for users.'}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"registration",children:"Registration"}),"\n",(0,r.jsx)(n.p,{children:"The first time users log in to HAWKI, they must go through the registration process, during which HAWKI2 establishes a secure encryption infrastructure that both protects individual user data and enables secure communication between users.\nThe registration process involves the creation of several cryptographic keys:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Passkey Creation"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Users create a master passkey during registration"}),"\n",(0,r.jsx)(n.li,{children:"This passkey serves as the root of the encryption system"}),"\n",(0,r.jsx)(n.li,{children:'A backup code is generated in the format "xxxx-xxxx-xxxx-xxxx"'}),"\n",(0,r.jsx)(n.li,{children:"The passkey is encrypted using a key derived from this backup code and stored server-side"}),"\n",(0,r.jsx)(n.li,{children:"The backup mechanism allows recovery if the user forgets their passkey"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Key Pair Generation"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"An RSA-OAEP key pair (2048-bit) is generated for asymmetric encryption"}),"\n",(0,r.jsx)(n.li,{children:"The public key is stored in the user's database record for others to encrypt messages to them"}),"\n",(0,r.jsx)(n.li,{children:"The private key is stored in the user's encrypted keychain"}),"\n",(0,r.jsx)(n.li,{children:"This key pair enables secure key exchange between users"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. AI Conversation Key Creation"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"An AES-256-GCM symmetric key is generated for AI conversations"}),"\n",(0,r.jsx)(n.li,{children:"This key is stored in the user's keychain and used to encrypt all AI conversation data (single chats)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"4. Keychain Initialization"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"User's keychain stores all cryptographic material (private key, symmetric keys)"}),"\n",(0,r.jsx)(n.li,{children:"The keychain itself is encrypted using a key derived from the user's passkey"}),"\n",(0,r.jsx)(n.li,{children:"Both client-side (IndexedDB) and server-side backups of the encrypted keychain are maintained"}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.em,{children:"After each login, the keychain on the indexDB will be compared to the one on the Server and will be updated if neccessary."})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image",src:s(644).A+"",width:"1021",height:"978"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"message-encryption",children:"Message Encryption"}),"\n",(0,r.jsx)(n.h3,{id:"ai-conversation-messages-aiconvmsg",children:"AI Conversation Messages (AiConvMsg)"}),"\n",(0,r.jsxs)(n.p,{children:["AI conversation messages are encrypted using the user's AI conversation key.\nSince the conversation (single chat) data only belongs the user, and since the conversation is mostly done using streaming, only one symmetric key (",(0,r.jsx)(n.code,{children:"AiConvKey"}),") is used for encryption both client and AI messages, which reduces the processing load drastically.\nOn the other hand since the none of the keys is allowed to be sent to server, the AI messages must also be encrypted on the client side and be sent back to the server.\nTo solve this problem, two copies of the user message are sent to the server via different routes: An encrypted copy that is stored in the database as ",(0,r.jsx)(n.code,{children:"AiConvMsg"}),", and an unencrypted copy that is sent to the AI model."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. User Messages to AI"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Messages are encrypted client-side using the user's aiConvKey (AES-256-GCM)"}),"\n",(0,r.jsx)(n.li,{children:"The encrypted message, along with its IV and authentication tag, is sent to the server"}),"\n",(0,r.jsx)(n.li,{children:"The server never sees unencrypted message content"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. AI Responses"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"AI responses are streamed to the client in chunks for real-time display"}),"\n",(0,r.jsx)(n.li,{children:"As chunks arrive, they're displayed to the user immediately"}),"\n",(0,r.jsx)(n.li,{children:"Once the complete response is received or the stream is aborted, it's encrypted with the aiConvKey"}),"\n",(0,r.jsx)(n.li,{children:"The encrypted response is sent to the server for storage"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Storage and Retrieval"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"All messages are stored in the database in encrypted form"}),"\n",(0,r.jsx)(n.li,{children:"When a conversation is loaded, messages are fetched and decrypted client-side"}),"\n",(0,r.jsx)(n.li,{children:"The system prompt for AI conversations is also encrypted with the same key"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"room-messages",children:"Room Messages"}),"\n",(0,r.jsx)(n.p,{children:"Messages in group chats (rooms) use a room-specific encryption system:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Room Key"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Each room has a unique symmetric AES-256-GCM key"}),"\n",(0,r.jsx)(n.li,{children:"This key is shared among all room members through secure key exchange"}),"\n",(0,r.jsx)(n.li,{children:"The room key is stored in each member's encrypted keychain"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. User Message Encryption"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"User messages are encrypted with the room key before being sent"}),"\n",(0,r.jsx)(n.li,{children:"The encrypted message includes an IV and authentication tag"}),"\n",(0,r.jsx)(n.li,{children:"Only members with access to the room key can decrypt these messages"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. AI Message Encryption"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"AI messages in group chats use a derived key from the room key"}),"\n",(0,r.jsx)(n.li,{children:"The derivation uses PBKDF2 with a server-provided salt and the room slug as context"}),"\n",(0,r.jsx)(n.li,{children:"This special AI encryption key allows the server to directly store AI messages in the database"}),"\n",(0,r.jsx)(n.li,{children:"When decrypting messages the AI encryption key will be derived again from the original room key."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"key-exchange",children:"Key Exchange"}),"\n",(0,r.jsx)(n.p,{children:"When a user creates a room or invites others to join, a secure key exchange occurs:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. For Users with Public Keys"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The room key is encrypted using the recipient's public key (RSA-OAEP)"}),"\n",(0,r.jsx)(n.li,{children:"This asymmetric encryption ensures only the recipient can decrypt the room key"}),"\n",(0,r.jsx)(n.li,{children:"The encrypted key is stored in the database as part of the invitation"}),"\n",(0,r.jsx)(n.li,{children:"When the recipient accepts the invitation, they decrypt the room key using their private key"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. For External Users without Public Keys"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"A temporary hash is generated for secure key sharing"}),"\n",(0,r.jsx)(n.li,{children:"The room key is encrypted using a key derived from this temporary hash"}),"\n",(0,r.jsx)(n.li,{children:"The encrypted key and temporary hash are stored separately"}),"\n",(0,r.jsx)(n.li,{children:"The hash is sent to the user via email"}),"\n",(0,r.jsx)(n.li,{children:"When the user registers and accepts the invitation, they use the hash to decrypt the room key"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Adding the Room Key to Keychain"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"After successful decryption, the room key is added to the user's keychain"}),"\n",(0,r.jsx)(n.li,{children:"The keychain is re-encrypted and backed up to the server"}),"\n",(0,r.jsx)(n.li,{children:"This process ensures the room key remains secure and persistent"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image",src:s(9722).A+"",width:"1363",height:"733"})}),"\n",(0,r.jsx)(n.h2,{id:"private-data-encryption",children:"Private Data Encryption"}),"\n",(0,r.jsx)(n.p,{children:"HAWKI2 protects various types of private user data through encryption:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. User Keychain"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stores all cryptographic keys (private key, room keys, AI key)"}),"\n",(0,r.jsx)(n.li,{children:"Encrypted using a key derived from the user's passkey"}),"\n",(0,r.jsx)(n.li,{children:"The derivation process uses PBKDF2 with 100,000 iterations and SHA-256"}),"\n",(0,r.jsx)(n.li,{children:"Server-provided salts enhance security and prevent rainbow table attacks"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Room Metadata"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Room descriptions and system prompts are encrypted with the room key"}),"\n",(0,r.jsx)(n.li,{children:"This ensures that even room configuration data remains private"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Passkey Backup"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The user's passkey is encrypted using a key derived from their backup code"}),"\n",(0,r.jsx)(n.li,{children:"This allows recovery without compromising the security of the passkey"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Security Considerations"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Zero-Knowledge Architecture"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The server never has access to unencrypted keys or message content"}),"\n",(0,r.jsx)(n.li,{children:"All encryption and decryption happens client-side in the browser"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Key Management"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Private keys never leave the client device in unencrypted form"}),"\n",(0,r.jsx)(n.li,{children:"All key transfers utilize asymmetric encryption or secure key derivation"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Cryptographic Standards"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Uses industry-standard algorithms: AES-256-GCM, RSA-OAEP, PBKDF2"}),"\n",(0,r.jsx)(n.li,{children:"Proper implementation of IVs, authentication tags, and salts"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"4. Sync and Recovery"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Encrypted keychain backup enables cross-device synchronization"}),"\n",(0,r.jsx)(n.li,{children:"Backup codes provide a secure recovery mechanism"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"5. Isolation"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Each conversation and room has its own encryption keys"}),"\n",(0,r.jsx)(n.li,{children:"Compromise of one key doesn't affect the security of other communications"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"This comprehensive encryption system ensures that all user data and communications in HAWKI2 remain\nprivate and secure, with the server acting only as a secure relay for encrypted content."})]})}function l(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},9722:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/Invitation-b74fa15a859ea297946bd7edcde1703a.png"},644:(e,n,s)=>{s.d(n,{A:()=>i});const i=s.p+"assets/images/register-c86add2522fee9df0654e3f353addb1c.png"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var i=s(6540);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);