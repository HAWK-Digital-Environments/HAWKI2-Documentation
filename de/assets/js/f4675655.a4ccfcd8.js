"use strict";(self.webpackChunkdocs_site=self.webpackChunkdocs_site||[]).push([[987],{9498:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"HAWKI/Architecture/Routes","title":"Routes","description":"Introduction","source":"@site/docs/HAWKI/3-Architecture/2-Routes.md","sourceDirName":"HAWKI/3-Architecture","slug":"/HAWKI/Architecture/Routes","permalink":"/HAWKI2-Documentation/de/HAWKI/Architecture/Routes","draft":false,"unlisted":false,"editUrl":"https://github.com/hawk/your-project/edit/main/docs/HAWKI/3-Architecture/2-Routes.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"HAWKI_Sidebar","previous":{"title":"Core Architecture","permalink":"/HAWKI2-Documentation/de/HAWKI/Architecture/Core Architecture"},"next":{"title":"Models Views Controllers","permalink":"/HAWKI2-Documentation/de/HAWKI/Architecture/MVC"}}');var i=n(4848),r=n(8453);const o={sidebar_position:2},c=void 0,a={},l=[{value:"Introduction",id:"introduction",level:3},{value:"Middleware",id:"middleware",level:3},{value:"Common Problems",id:"common-problems",level:3}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h3,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(t.p,{children:["Routing is a core aspect in MVC architecture, directing URLs to specific controllers and actions. It defines how users interact with the application by mapping HTTP requests to application logic. Routes are defined in ",(0,i.jsx)(t.code,{children:"routes/web.php"})," for web interfaces and ",(0,i.jsx)(t.code,{children:"routes/api.php"})," for API endpoints."]}),"\n",(0,i.jsx)(t.p,{children:"Each route in the application is responsible for directing a request to a specific function within its designated controller. To maintain clarity and organization, no business logic is directly implemented within the web.php or api.php files. Instead, logic is encapsulated within separate functions in the controllers."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"image",src:n(2033).A+"",width:"1795",height:"703"})}),"\n",(0,i.jsxs)(t.p,{children:["Routes that handle application requests are prefixed with ",(0,i.jsx)(t.code,{children:"/req/"}),", which distinguishes them from routes intended for rendering views. This clear distinction ensures the routes associated with rendering views directly describe the target view, promoting readability and easier navigation within the codebase."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.em,{children:"Example:"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-JS",children:"// Render Login View\nRoute::get('/login', [LoginController::class, 'index']);\n// Send Login Request\nRoute::post('/req/login-ldap', [AuthenticationController::class, 'ldapLogin']);\n"})}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Facade"}),(0,i.jsx)(t.th,{children:"Method"}),(0,i.jsx)(t.th,{children:"Route"}),(0,i.jsx)(t.th,{children:"Controller"}),(0,i.jsx)(t.th,{children:"Function"})]})}),(0,i.jsx)(t.tbody,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Route::"}),(0,i.jsx)(t.td,{children:"get"}),(0,i.jsx)(t.td,{children:"'/login'"}),(0,i.jsx)(t.td,{children:"LoginController::class"}),(0,i.jsx)(t.td,{children:"'index'"})]})})]}),"\n",(0,i.jsx)(t.p,{children:"To decrease the time required to register the defined routes, it's recommended to cache the routes, when deploying HAWKI on your webspace, using:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"php artisan route:cache\n"})}),"\n",(0,i.jsx)(t.p,{children:"However, after updating or modifying the routes, this cache should be cleared and redone if necessary:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"php artisan route:clear\nphp artisan route:cache\n"})}),"\n",(0,i.jsx)(t.p,{children:"To list the registered routes use:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"php artisan route:list\n"})}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"middleware",children:"Middleware"}),"\n",(0,i.jsx)(t.p,{children:"Middlewares provide a filtering mechanism for HTTP requests, which ensures the safety of the routes from various attacks or unauthorized access.\nThere are several middlewares implemented in HAWKI, which beside the built in Laravel middlewares restrict and filter routes."}),"\n",(0,i.jsx)(t.p,{children:"Middlewares can be applied to a single route:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"Route::get('/register', [AuthenticationController::class, 'register'])->middleware('registrationAccess');\n"})}),"\n",(0,i.jsx)(t.p,{children:"or a group of routes:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"Route::middleware('registrationAccess')->group(function () {\n\n    Route::get('/register', [AuthenticationController::class, 'register']);\n    ...\n});\n"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Aliases"})}),"\n",(0,i.jsxs)(t.p,{children:["Each middleware is registered with a shorter alias in the ",(0,i.jsx)(t.code,{children:"AppServiceProvider.php"})," for better readablity in the code."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"Route::aliasMiddleware('registrationAccess', RegistrationAccess::class);\n"})}),"\n",(0,i.jsx)(t.p,{children:"Here is short description of the main middlewares in HAWKI"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"CSRF Token Validation"}),"\nBy default ",(0,i.jsx)(t.code,{children:"ValidateCsrfToken"})," middleware is included in the ",(0,i.jsx)(t.code,{children:"web"})," middleware. It means that all of the POST routes registered in ",(0,i.jsx)(t.code,{children:"web.php"})," will be checked for the ",(0,i.jsx)(t.code,{children:"X-CSRF-TOKEN"})," in the header of the request to protect the routes from ",(0,i.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Cross-site_request_forgery",children:"Cross-site request forgery"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"Authentication"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"auth"})," middleware is also one of the built-in middlewares, which works as a part of the ",(0,i.jsx)(t.code,{children:"Illuminate\\Support\\Facades\\Auth"})," facade with the main responsibility to allow access only to the authenticated clients."]}),"\n",(0,i.jsxs)(t.p,{children:["For more information refer to the ",(0,i.jsx)(t.a,{href:"/HAWKI2-Documentation/de/HAWKI/Architecture/Authentication",children:"Authentication Section"})]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.strong,{children:"Sanctum Authentication"})}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"In HAWKI 2 users are able to create API tokens and use them in the external applications. The token creation and management is done by Laravel Sanctum. Sanctums auth middleware ensures that the request inclued the authentication token in the header. Accordingly compares the token with the assigned tokens to HAWKI users and authenticates them before passing the request to controller."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.strong,{children:"Registration Access"})}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"As the user is logging in for the first time on HAWKI, a temporary access is granted until completing the registration and before completing the handshake and logging the user in. At this point the client is allowed to access specific routes such as receiving encryption salts from the server or setup and backup registration data."}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Important:"}),"\n",(0,i.jsx)(t.code,{children:"auth"})," middleware bypasses the ",(0,i.jsx)(t.code,{children:"RegistrationAccess"}),". In other words if the user is already logged in, they can access the routes which are protected by ",(0,i.jsx)(t.code,{children:"RegistrationAccess"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.strong,{children:"Session Expiry Check"})}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"This middleware checks the idle time of the session. This way if the Session is already ended by the built in garbage collection mechanism of PHP, the user will be redirected to the login page, when trying to send any request."}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"Although the same logic applies if the user reloads the page, before reloading, the frontend side will still try to send requests but will throw errors instead."}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"The frontend session timer also ensures that the user is informed about the session timout event."}),"\n"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.strong,{children:"PreventBackHistory"})}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Browsers by default use the cached data when trying to navigate in the website by using history forward and back buttons. This will be problematic as the logged out user can still use back button to navigate to the home page, although the session does not exist anymore.\nThis middleware ensures that the navigation using with the cached data is not possible."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.strong,{children:"Admin Access & Editor Access"})}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The defined roles in the Groupchat restrict users' access to the room.\nTo ensure that the user sending the request is a member with the required access level, ",(0,i.jsx)(t.code,{children:"AdminAccess"})," and ",(0,i.jsx)(t.code,{children:"EditorAccess"})," check the member role before passing the request to the controller."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.strong,{children:"External Communication Check"})}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["As described in the Sanctum Authentication above, users can access the API endpoint using their token. However, the .env variable ",(0,i.jsx)(t.code,{children:"ALLOW_EXTERNAL_COMMUNICATION"})," allows the server admin to turn this feature on or off. In the scenario when external communication has been previously allowed and turned off afterwards, sanctum still is active and will check the provided tokens. In this case ",(0,i.jsx)(t.code,{children:"ExternalCommunicationCheck"})," in parallel ensures that this is allowed."]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"common-problems",children:"Common Problems"}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"1- The newly added routes return 404 error."})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Make sure the the route path and the path defined in the fetch request are identic."}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"use network tab in the inspect element to make sure the request url is the same as the one in code.\nIf not, empty cache and reload the browser to update to the newer version of the script."}),"\n"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Make sure the controller class and function are correct and exist."}),"\n",(0,i.jsx)(t.li,{children:"Refresh the route cache:"}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"php artisan route:clear\nphp artisan route:cache //Optional\n"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Check if the route is listed correctly."}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"php artisan route:list\n"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"2- Route is listed correctly but the request still throws 404 error."})}),"\n",(0,i.jsx)(t.p,{children:"If the solution in the previous step did not solve the problem: The problem may be caused by a middleware."}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Check if there is a middleware filtering the route. If so try to temporarly move the route of the middleware group or remove the middleware assigned to the route. If this solved the issue the request is blocked by the middleware."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Check if the middleware exists in the ",(0,i.jsx)(t.code,{children:"app/http/Middleware"})," folder. Also check if the name or alias in ",(0,i.jsx)(t.code,{children:"AppServiceProviders.php"})," as well as the routes file is correct."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Try clearing config and cache:"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"php artisan config:clear\nphp artisan cache:clear\nphp artisan route:clear\nphp artisan view:clear\n"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Try restarting artisan server if in local development mode."}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},2033:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/routes-ca8905eb8927757f7f07d691b9cc2384.png"},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>c});var s=n(6540);const i={},r=s.createContext(i);function o(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);