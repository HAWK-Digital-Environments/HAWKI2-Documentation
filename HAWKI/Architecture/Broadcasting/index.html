<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-HAWKI/Architecture/Broadcasting" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Broadcasting | HAWK Research</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hawk-digital-environments.github.io/HAWKI2-Documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hawk-digital-environments.github.io/HAWKI2-Documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hawk-digital-environments.github.io/HAWKI2-Documentation/HAWKI/Architecture/Broadcasting"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="de"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Broadcasting | HAWK Research"><meta data-rh="true" name="description" content="Overview of the Broadcasting Process"><meta data-rh="true" property="og:description" content="Overview of the Broadcasting Process"><link data-rh="true" rel="icon" href="/HAWKI2-Documentation/img/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://hawk-digital-environments.github.io/HAWKI2-Documentation/HAWKI/Architecture/Broadcasting"><link data-rh="true" rel="alternate" href="https://hawk-digital-environments.github.io/HAWKI2-Documentation/HAWKI/Architecture/Broadcasting" hreflang="en"><link data-rh="true" rel="alternate" href="https://hawk-digital-environments.github.io/HAWKI2-Documentation/de/HAWKI/Architecture/Broadcasting" hreflang="de"><link data-rh="true" rel="alternate" href="https://hawk-digital-environments.github.io/HAWKI2-Documentation/HAWKI/Architecture/Broadcasting" hreflang="x-default"><link rel="stylesheet" href="/HAWKI2-Documentation/assets/css/styles.a2635f23.css">
<script src="/HAWKI2-Documentation/assets/js/runtime~main.d313e222.js" defer="defer"></script>
<script src="/HAWKI2-Documentation/assets/js/main.1f6ba4ff.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/HAWKI2-Documentation/"><div class="navbar__logo"><img src="/HAWKI2-Documentation/img/hawk-logo.svg" alt="HAWK Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/HAWKI2-Documentation/img/hawk-logo-dark.svg" alt="HAWK Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a href="https://www.hawki.info/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-info-link" aria-label="GitHub repository"></a><a href="https://github.com/HAWK-Digital-Environments/HAWKI" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/HAWKI2-Documentation/">Prologue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/HAWKI2-Documentation/HAWKI/Getting Started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/HAWKI2-Documentation/category/architecture">Architecture</a><button aria-label="Collapse sidebar category &#x27;Architecture&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/Core Architecture">Core Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/Routes">Routes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/MVC">Models Views Controllers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/Encryption">Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/Model Connection">Model Connection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/Broadcasting">Broadcasting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/Mail Service">Mail Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/Authentication">Authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/dot Env">dot Env</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/HAWKI2-Documentation/HAWKI/Architecture/Usage Record">Usage Record</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/HAWKI2-Documentation/category/deployment">Deployment</a><button aria-label="Expand sidebar category &#x27;Deployment&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/HAWKI2-Documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/HAWKI2-Documentation/category/architecture"><span itemprop="name">Architecture</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Broadcasting</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Broadcasting</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview-of-the-broadcasting-process">Overview of the Broadcasting Process<a href="#overview-of-the-broadcasting-process" class="hash-link" aria-label="Direct link to Overview of the Broadcasting Process" title="Direct link to Overview of the Broadcasting Process">​</a></h2>
<p>The HAWKI2 system implements a robust message broadcasting architecture to deliver real-time encrypted
messages to all members of a room. This process combines Laravel&#x27;s queueing and broadcasting systems to
ensure efficient and reliable delivery while maintaining end-to-end encryption.</p>
<p>As is metioned in the <a href="/HAWKI2-Documentation/docs/HAWKI/Architecture/encryption">Encryption</a> section, in the groupchat rooms if the AI model is mentioned in the message, the chatlog will be prepared and sent to StreamController, also including a derived encryption key to be used by the server.
After receiving the answer from the AI model, the server needs to broadcast the message to all the room members, that have established the connection through websocket channels.</p>
<p><img decoding="async" loading="lazy" alt="image" src="/HAWKI2-Documentation/assets/images/roomMsg-58956aa76b0180ba1638f181cfae6fe1.png" width="1216" height="1395" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="broadcasting-flow">Broadcasting Flow<a href="#broadcasting-flow" class="hash-link" aria-label="Direct link to Broadcasting Flow" title="Direct link to Broadcasting Flow">​</a></h3>
<p><strong>1. Message Creation and Encryption</strong></p>
<ul>
<li>When a user sends a message, it&#x27;s first encrypted client-side using the room key</li>
<li>The encrypted message (ciphertext, IV, and tag) is sent to the server</li>
<li>The server creates a message record in the database</li>
</ul>
<p><strong>2. Job Dispatching</strong></p>
<ul>
<li>After persisting the message, the RoomController dispatches a SendMessage job:<!-- -->
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">SendMessage</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token function" style="color:#d73a49">onQueue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;message_broadcast&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>This job is placed on a dedicated queue named &#x27;message_broadcast&#x27;</li>
<li>The queue allows the server to handle broadcasting asynchronously without blocking the response</li>
</ul>
<p><strong>3. Queue Processing</strong></p>
<ul>
<li>Laravel&#x27;s queue worker processes the queued job</li>
<li>The system uses a database queue driver (configured in <code>queue.php</code>)</li>
<li>This ensures messages are not lost if the system crashes during processing</li>
</ul>
<p><strong>4. Broadcasting Event Creation</strong></p>
<ul>
<li>The SendMessage job prepares message data and creates a RoomMessageEvent</li>
<li>This event includes all encrypted message data</li>
<li>The event is formatted with metadata needed by clients for proper handling</li>
</ul>
<p><strong>5. Event Broadcasting</strong></p>
<ul>
<li>The RoomMessageEvent implements Laravel&#x27;s ShouldBroadcast interface</li>
<li>The event is broadcasted to a private channel specific to the room:<!-- -->
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">broadcastOn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> array </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $slug </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">Room</span><span class="token operator" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">:</span><span class="token function" style="color:#d73a49">findOrFail</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$</span><span class="token keyword" style="color:#00009f">this</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;messageData&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;room_id&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">slug</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">PrivateChannel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Rooms.&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token property-access">$slug</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<p><strong>6. WebSocket Delivery</strong></p>
<ul>
<li>Laravel Reverb (configured in <code>reverb.php</code>) handles the WebSocket connections</li>
<li>Laravel Echo on the client side listens for these events</li>
<li>The connection is authenticated using Laravel Sanctum</li>
</ul>
<p><img decoding="async" loading="lazy" alt="image" src="/HAWKI2-Documentation/assets/images/broadcasting-bcc95c891a61f0e7e8365b6e7c11a350.png" width="1765" height="516" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="client-side-reception">Client-Side Reception<a href="#client-side-reception" class="hash-link" aria-label="Direct link to Client-Side Reception" title="Direct link to Client-Side Reception">​</a></h3>
<p><strong>1. Channel Subscription</strong></p>
<p>When a user enters a room, the client subscribes to the room&#x27;s private channel:</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">Echo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">private</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">webSocketChannel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;RoomMessageEvent&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// Handle the incoming message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>2. Message Processing</strong></p>
<p>Upon receiving a message, the client:</p>
<ul>
<li>Retrieves the appropriate key from the user&#x27;s keychain</li>
<li>Decrypts the message using the room key or AI key</li>
<li>Updates the UI with the decrypted content</li>
</ul>
<p><strong>3. Typing Indicators</strong></p>
<ul>
<li>Real-time typing indicators use <strong>whisper channels</strong></li>
<li>These side-channel communications don&#x27;t persist to the database</li>
<li>Provide immediate feedback without requiring full broadcasts</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="libraries-and-technologies">Libraries and Technologies<a href="#libraries-and-technologies" class="hash-link" aria-label="Direct link to Libraries and Technologies" title="Direct link to Libraries and Technologies">​</a></h2>
<p>The broadcasting system leverages several key technologies:</p>
<p><strong>1. Laravel Echo</strong></p>
<ul>
<li>Client-side JavaScript library for subscribing to WebSocket channels</li>
<li>Handles connection maintenance and reconnection logic</li>
<li>Provides a simple API for listening to events</li>
</ul>
<p><strong>2. Laravel Reverb</strong></p>
<ul>
<li>WebSocket server implementation by Laravel</li>
<li>Configured as the primary broadcast driver</li>
<li>Handles authentication, channel management and scaling</li>
</ul>
<p><strong>3. Laravel Queues</strong></p>
<ul>
<li>Uses the database driver for reliable message processing</li>
<li>Separates the broadcasting process from the web request cycle</li>
<li>Allows for better performance and fault tolerance</li>
</ul>
<p><strong>4. Laravel Events</strong></p>
<ul>
<li>The event system ties everything together</li>
<li>RoomMessageEvent class defines the data structure and target channels</li>
<li>Implements ShouldBroadcast for automatic WebSocket delivery</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-considerations">Security Considerations<a href="#security-considerations" class="hash-link" aria-label="Direct link to Security Considerations" title="Direct link to Security Considerations">​</a></h2>
<p><strong>1. Private Channels</strong></p>
<ul>
<li>All communication happens on private channels that require authentication</li>
<li>Channel names include the room slug, isolating conversations</li>
</ul>
<p><strong>2. End-to-End Encryption</strong></p>
<ul>
<li>All message content remains encrypted throughout the broadcasting process</li>
<li>The server only routes the encrypted data without access to decryption keys</li>
</ul>
<p><strong>3. Authentication</strong></p>
<ul>
<li>Channel subscriptions are authenticated via Laravel Sanctum</li>
<li>Only room members can subscribe to the room&#x27;s channel</li>
</ul>
<p>This comprehensive broadcasting architecture ensures that messages are delivered efficiently and
securely to all room members, maintaining the end-to-end encryption that is core to HAWKI2&#x27;s security
model.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/hawk/your-project/edit/main/docs/HAWKI/3-Architecture/5-Broadcasting.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/HAWKI2-Documentation/HAWKI/Architecture/Model Connection"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Model Connection</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/HAWKI2-Documentation/HAWKI/Architecture/Mail Service"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Mail Service</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview-of-the-broadcasting-process" class="table-of-contents__link toc-highlight">Overview of the Broadcasting Process</a><ul><li><a href="#broadcasting-flow" class="table-of-contents__link toc-highlight">Broadcasting Flow</a></li><li><a href="#client-side-reception" class="table-of-contents__link toc-highlight">Client-Side Reception</a></li></ul></li><li><a href="#libraries-and-technologies" class="table-of-contents__link toc-highlight">Libraries and Technologies</a></li><li><a href="#security-considerations" class="table-of-contents__link toc-highlight">Security Considerations</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made with Docusaurus © 2025</div></div></div></footer></div>
</body>
</html>